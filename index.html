<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ASCII live · app</title>

  <!-- иконки / цвета телеги можно не трогать -->
  <meta name="theme-color" content="#000000"/>

  <!-- стили -->
  <link rel="stylesheet" href="styles.css?v=fixA1"/>

  <!-- шрифт BetterVCR (останется в UI), для ASCII используем monospace -->
  <style>
    @font-face{
      font-family:'BetterVCR';
      src:url('assets/BetterVCR.woff2') format('woff2'),
          url('assets/BetterVCR.woff')  format('woff');
      font-display:swap;
      font-weight:400;
      font-style:normal;
    }
  </style>
</head>
<body class="theme-dark">

  <div class="wrap">

    <!-- верхняя панель -->
    <div class="toolbar">
      <button id="flip"   class="btn">Фронт/Тыл</button>
      <button id="toggle" class="btn">Настройки</button>
    </div>

    <!-- панель настроек (cкрыта при первом входе) -->
    <div id="settings" class="panel" hidden>
      <label>Ширина
        <input id="w" type="range" min="40" max="340" step="2" value="160"/>
        <span id="wv">160</span>
      </label>

      <label>Контраст
        <input id="ctr" type="range" min="0.60" max="1.80" step="0.01" value="1.15"/>
        <span id="ctrv">1.15</span>
      </label>

      <label>Гамма
        <input id="gm" type="range" min="0.80" max="1.40" step="0.01" value="1.20"/>
        <span id="gmv">1.20</span>
      </label>

      <label>Цвет
        <input id="fg" type="color" value="#8ac7ff"/>
      </label>

      <label>Фон
        <input id="bg" type="color" value="#000000"/>
      </label>

      <label>FPS
        <input id="fps" type="range" min="5" max="60" step="1" value="30"/>
        <span id="fpsv">30</span>
      </label>

      <label>Набор
        <select id="charset">
          <option value="classic">Классический</option>
          <option value="digits">Только цифры</option>
          <option value="letters">Только буквы</option>
          <option value="dots">Из точек</option>
          <option value="mixed">Смешанный</option>
        </select>
      </label>

      <label class="check">
        <input id="invert" type="checkbox" checked />
        Инверсия
      </label>
    </div>

    <!-- сцена -->
    <div class="stage">
      <pre id="out"></pre>
    </div>
  </div>

  <script src="ascii.js?v=fixA1"></script>
  <script>
  (()=>{

    // ====== UI ======
    const ui = {
      toggle   : document.getElementById('toggle'),
      settings : document.getElementById('settings'),
      flip     : document.getElementById('flip'),

      w   : document.getElementById('w'),
      wv  : document.getElementById('wv'),
      ctr : document.getElementById('ctr'),
      ctrv: document.getElementById('ctrv'),
      gm  : document.getElementById('gm'),
      gmv : document.getElementById('gmv'),
      fg  : document.getElementById('fg'),
      bg  : document.getElementById('bg'),
      fps : document.getElementById('fps'),
      fpsv: document.getElementById('fpsv'),
      cs  : document.getElementById('charset'),
      inv : document.getElementById('invert'),
    };

    // восстановим «свернуто/развернуто»
    const savedOpen = localStorage.getItem('ui-settings-open') === '1';
    if (!savedOpen) ui.settings.setAttribute('hidden','');

    ui.toggle.onclick = () => {
      const hidden = ui.settings.hasAttribute('hidden');
      if (hidden) {
        ui.settings.removeAttribute('hidden');
        localStorage.setItem('ui-settings-open','1');
      } else {
        ui.settings.setAttribute('hidden','');
        localStorage.setItem('ui-settings-open','0');
      }
    };

    // ====== ASCII player ======
    const player = new AsciiPlayer({
      out: document.getElementById('out'),
      width: +ui.w.value,
      contrast: +ui.ctr.value,
      gamma: +ui.gm.value,
      color: ui.fg.value,
      background: ui.bg.value,
      fps: +ui.fps.value,
      charset: ui.cs.value,
      invert: ui.inv.checked,
    });

    // фронталка/тыл
    ui.flip.onclick = () => player.toggleFacingMode();

    // биндим контролы
    const onRange = (el, lbl, fn) => {
      const h = () => { lbl && (lbl.textContent = el.value); fn(+el.value); };
      el.addEventListener('input', h); h();
    };

    onRange(ui.w,   ui.wv,  v => player.setOptions({width:v}));
    onRange(ui.ctr, ui.ctrv, v => player.setOptions({contrast:v}));
    onRange(ui.gm,  ui.gmv,  v => player.setOptions({gamma:v}));
    onRange(ui.fps, ui.fpsv, v => player.setOptions({fps:v}));

    ui.fg.addEventListener('input', e => player.setOptions({color:e.target.value}));
    ui.bg.addEventListener('input', e => player.setOptions({background:e.target.value}));

    ui.cs.addEventListener('change', e => player.setOptions({charset:e.target.value}));
    ui.inv.addEventListener('change', e => player.setOptions({invert:e.target.checked}));

  })();
  </script>
</body>
</html>
