<!doctype html><html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ASCII live · app</title>
<link rel="stylesheet" href="styles.css">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head><body class="theme-dark">
<div class="wrap">
  <div class="toolbar" id="toolbar">
    <button id="flip" class="btn">Фронт/Тыл</button>
    <button id="fs" class="btn ghost">Fullscreen</button>
    <a class="btn ghost" href="pro.html">Настройки</a>
  </div>
  <div class="stage"><pre id="out"></pre></div>
</div>

<!-- Дисклеймер: показываем до старта камеры -->
<div class="modal" id="consent" hidden>
  <div class="card">
    <h3>Доступ к камере</h3>
    <p>Видеопоток обрабатывается локально на вашем устройстве, без отправки на сервер.</p>
    <p><a href="privacy.html" target="_blank" rel="noopener">Подробнее</a></p>
    <button id="agree" class="btn" type="button">Ок, понимаю</button>
  </div>
</div>

<script type="module">
import { AsciiApp, enableMobileFullscreen } from './ascii.js';
if (window.Telegram?.WebApp) { Telegram.WebApp.ready(); Telegram.WebApp.expand(); }

const ui = {
  flip: document.getElementById('flip'),
  fs: document.getElementById('fs'),
  out: document.getElementById('out'),
  toolbar: document.getElementById('toolbar'),
  consent: document.getElementById('consent'),
  agree: document.getElementById('agree')
};

const app = new AsciiApp(ui.out);
enableMobileFullscreen(ui.fs, ui.toolbar);
app.setOptions({}); // цвета

// Порядок старта:
// 1) если есть согласие — стартуем сразу;
// 2) если нет — показываем модалку и стартуем по клику «Ок».
if (localStorage.getItem('consent-ok') === '1') {
  app.start().catch(e => alert('Камера недоступна: ' + e.message));
} else {
  ui.consent.hidden = false;
}
ui.agree.onclick = () => {
  localStorage.setItem('consent-ok','1');
  ui.consent.hidden = true;
  app.start().catch(e => alert('Камера недоступна: ' + e.message));
};

ui.flip.onclick = () => app.flip();
</script>
</body></html>
