/* ===== БАЗА ===== */
* { box-sizing: border-box; }
html,body{ height:100%; margin:0; }
body.theme-dark{ background:#000; color:#fff; }
html, body, .wrap { overflow-x: hidden; }
.panel label { flex-wrap: wrap; }

:root{
  --ui-bg:#151515;     /* тулбар/фон панели */
  --ui-panel:#1b1b1b;  /* карточки внутри панели */
  --ui-text:#ffffff;
}

.wrap{ display:flex; flex-direction:column; height:100%; }
/* ===== АНТИ-ВЫДЕЛЕНИЕ UI ===== */
/* На всём приложении — нельзя выделять, вызывать callout, перетаскивать */
.wrap, .toolbar, .panel, .modebar,
button, .btn, label, output {
  -webkit-user-select: none;
      -ms-user-select: none;
          user-select: none;
  -webkit-touch-callout: none;        /* отключает лонгтап-меню iOS */
  -webkit-tap-highlight-color: transparent; /* убирает синий флэш на мобилках */
}

/* Но полям ввода — можно (иначе нельзя править кастомный набор и т.п.) */
input, textarea, select {
  -webkit-user-select: text;
          user-select: text;
  -webkit-touch-callout: default;
}

/* Запретить перетаскивание медиа/пре */
img, video, canvas, pre {
  -webkit-user-drag: none;
          user-drag: none;
}

/* На всякий: ссылки в тулбарах (если появятся) тоже без выделения */
.toolbar a, .modebar a { 
  -webkit-user-select: none;
          user-select: none;
  -webkit-touch-callout: none;
}

/* ===== ТУЛБАР ===== */
.toolbar {
  display:flex; gap:8px; align-items:center;
  justify-content:center;
  padding:10px;
  background:#000; 
}

/* ===== КНОПКИ — полностью прозрачные ===== */
button, .btn, input[type="button"], input[type="submit"]{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  background:transparent !important;
  background-image:none !important;
  color:var(--ui-text);
  border:0 !important; outline:none !important; box-shadow:none !important;
  padding:.55rem 1rem; border-radius:0; cursor:pointer;
  -webkit-tap-highlight-color:transparent;
}
button:hover, .btn:hover,
button:active, .btn:active,
button:focus, .btn:focus{
  background:transparent !important;
  border:0 !important; outline:none !important; box-shadow:none !important;
}

/* ===== ПАНЕЛЬ ===== */
.panel{
  display:flex; flex-wrap:wrap; gap:12px; padding:8px;
  background:var(--ui-bg);
}
.panel[hidden]{ display:none !important; }
[hidden] { display: none !important; }
.panel label{
  display:flex; gap:8px; align-items:center;
  background:transparent;
  padding:6px 8px; border-radius:0;
}
.panel input[type="range"]{ width:160px; }
.panel output{ min-width:42px; text-align:right; }

.panel .row.colors{
  display:flex;
  flex-wrap: wrap;     /* можно переносить на следующую строку */
  gap:6px;             /* небольшой зазор между ТЕКСТ и ФОН */
  width:auto;          /* не занимать всю строку насильно */
  align-items:center;
}

.panel .row.colors .color{
  flex:0 0 auto;       /* не растягивать плашки */
  display:flex;
  align-items:center;
  gap:4px;             /* расстояние между словом и квадратом */
  white-space:nowrap;  /* внутри плашки текст+квадрат не рвём */
}

/* компактный чекбокс — показываем только текст, без квадратика */
.check{
  display:flex;
  align-items:center;
  /* gap убираем, т.к. остаётся только текст */
  padding:6px 8px;
  cursor:pointer;
}
.check input[type="checkbox"]{
  display:none;        /* полностью убираем из потока, клики по label всё равно работают */
}

/* ===== СЦЕНА/ВЫВОД ===== */
.stage{
  flex:1; min-height:0; position:relative;
  background:#000; overflow:hidden;
}

#out{
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%) scale(1);
  transform-origin:center center;
  margin:0;
  user-select:none;

  font-family: "MS Gothic",monospace;
  font-weight: 400;
  font-variant-ligatures: none;
  -webkit-font-smoothing: none;
  white-space: pre;
  letter-spacing: 0em;
  line-height: 1;

  font-size:16px;
  color:#8ac7ff;
  background:#000;
}

/* ===== RANGE (ползунки) — белый тонкий трек, квадратный белый бегунок ===== */
input[type="range"]{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  background:transparent; height:18px;
  margin:0; padding:0;
}
/* WebKit */
input[type="range"]::-webkit-slider-runnable-track{
  height:2px; background:#fff; border:none; box-shadow:none;
}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:16px; height:16px; background:#fff;
  border:none; border-radius:0; margin-top:-7px; box-shadow:none;
}
/* Firefox */
input[type="range"]::-moz-range-track{
  height:2px; background:#fff; border:none;
}
input[type="range"]::-moz-range-thumb{
  width:16px; height:16px; background:#fff;
  border:none; border-radius:0; box-shadow:none;
}
/* MS Edge (old) */
input[type="range"]::-ms-track{
  height:2px; background:transparent; border-color:transparent; color:transparent;
}
input[type="range"]::-ms-fill-lower,
input[type="range"]::-ms-fill-upper{
  background:#fff; border:none;
}
input[type="range"]::-ms-thumb{
  width:16px; height:16px; background:#fff;
  border:none; border-radius:0; margin-top:0; box-shadow:none;
}

/* ===== SELECT/INPUT — без рамок/заливок, белый текст ===== */
input, select, textarea{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  background:transparent; color:var(--ui-text);
  border:0 !important; outline:none !important; box-shadow:none !important;
}
/* Color picker — убираем рамки квадратиков */
input[type="color"]::-webkit-color-swatch-wrapper { padding:0; }
input[type="color"]::-webkit-color-swatch { border:none; }
input[type="color"]::-moz-color-swatch { border:none; }

select{ background:transparent; color:var(--ui-text); }
option{ background:var(--ui-panel); color:var(--ui-text); }

/* небольшая защита от «прыжков» при клавиатуре на мобилках */
@supports (padding: env(safe-area-inset-bottom)){
  .wrap{ padding-bottom: env(safe-area-inset-bottom); }
}

/* Поле пользовательского набора символов:
   базовая (десктопная) ширина + ограничение, чтобы не вылезало за экран */
#charset_custom {
  width: 260px;           /* как было на десктопе */
  max-width: 60vw;        /* но не шире 60% экрана */
  display: none;          /* показываем/прячем через JS */
}
/* === Шрифт для CJK (MS Gothic) === */
@font-face {
    font-family: "MS Gothic";
    src: url("./assets/MS Gothic.woff2") format("woff2");
    font-weight: 400;
    font-style: normal;
    font-display: swap;
}
@font-face {
  font-family: "BetterVCR";
  src: url("./assets/BetterVCR.woff2") format("woff2");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

/* === Шрифт интерфейса === */
body, .toolbar, .panel, .btn, label, output, select, option {
  font-family: 'BetterVCR', sans-serif;
  font-size: 18px; /* сделает одинаковым для кнопок и подписей */
  line-height: 1.1;
}

/* ===== FULLSCREEN ===== */
:fullscreen .toolbar,
:fullscreen .panel,
:fullscreen .modebar { display:none !important; }

.body-fullscreen .toolbar,
.body-fullscreen .panel,
.body-fullscreen .modebar { display:none !important; }


.fs-exit {
  position:fixed; top:10px; right:10px; width:36px; height:36px;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,.6);
  color:var(--ui-text);
  cursor:pointer; z-index:9999; user-select:none;
}
.fs-exit::after { content:"⤢"; font-size:18px; line-height:1; }

.body-fullscreen .stage { width:100vw; height:100vh; }

/* === Fullscreen fallback / Чистый экран на мобилках без системного FS === */
.body-fullscreen {
  overflow: hidden;
}

.body-fullscreen .wrap#app {
  position: fixed !important;
  inset: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  background: #000; /* чтобы не просвечивало */
  z-index: 9999;
}

.body-fullscreen #stage {
  width: 100%;
  height: 100%;
  touch-action: none; /* сцена должна ловить пинч даже в фоллскрине */
}
/* === BUSY OVERLAY === */
#busy{
  position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,.75);
  z-index: 2;           /* поверх #out и #placeholder */
  backdrop-filter: blur(2px);
}
#busy[hidden]{ display:none !important; }

#busy .busy-box{
  display:flex; flex-direction:column; align-items:center; gap:24px; /* ↑ больше расстояние */
  padding:0;                                      /* без внутренней карты */
  background:transparent;                         /* убрали подложку */
  border:none;                                    /* убрали белую рамку */
  box-shadow:none;
}


#busy .busy-text{
  color:#fff; font-family:'BetterVCR', sans-serif; font-size:18px;
  text-align:center; white-space:pre-line;
}

/* === CUSTOM LOGO SPINNER === */
.busy-spinner {
  position: relative;
  width: 64px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.spinner-layer {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.spinner-layer img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  pointer-events: none;
}

/* вращается только внешняя часть (лепестки) с инерцией */
.spinner-layer.flower{
  animation: spin-inertia 2.6s cubic-bezier(.2,.8,.2,1) infinite;
  transform-origin: center;
  will-change: transform;
}

/* зрачок остаётся статичным */
.spinner-layer.pupil{ animation: none; }

/* Разгон → один оборот → замедление → пауза (без перекрутки) */
@keyframes spin-inertia{
  0%   { transform: rotate(0turn); }
  70%  { transform: rotate(1turn); }  /* один полный оборот завершён */
  100% { transform: rotate(1turn); }  /* короткая пауза в конце */
}

/* На всякий случай: скрыть любые пережитки иконок выхода, если где-то остались */
.fs-exit,
#fs-exit {
  display: none !important;
}

/* ===== Мобильный компакт-вид ===== */
@media (max-width: 600px) {
  /* Меньше шрифт по всему UI */
  body, .toolbar, .panel, .btn, label, output, select, option {
    font-size: 14px;
  }

  /* Кнопки и панель */
  .toolbar { gap: 6px; padding: 6px; flex-wrap: wrap; }
  .btn { padding: .4rem .6rem; }
  .panel { gap: 8px; padding: 6px; }
  .panel label { gap: 6px; padding: 4px 6px; }

  /* Слайдеры компактнее */
  .panel input[type="range"] { width: 140px; height: 14px; }
  input[type="range"]::-webkit-slider-thumb { width: 12px; height: 12px; margin-top: -5px; }
  input[type="range"]::-moz-range-thumb     { width: 12px; height: 12px; }

  /* Селекты/инпуты */
  select { max-width: 58vw; }
  #charset_custom { width:100% !important; max-width:62vw; }

  /* Ряд цветов — компактно и без переполнения */
  .panel .row.colors { flex-wrap: wrap; gap:4px; width:auto; }
  .panel .row.colors .color { flex:0 0 auto; gap:2px; white-space:nowrap; }
}

/* очень узкие экраны — можно сложить цвета в столбик (по желанию) */
@media (max-width: 360px){
  .panel .row.colors{ flex-direction: column; }
}

/* ===== НИЖНИЙ РЯД РЕЖИМОВ ===== */
.modebar{
  display:flex; justify-content:center; gap:12px;
  padding:10px; background:#000; border-top:1px solid #111;
}

/* ===== ПЛЕЙСХОЛДЕР ДЛЯ ФОТО/ВИДЕО ===== */
#out { z-index: 1; }  
#placeholder{
  position:absolute; inset:0;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:8px; color:#cfe6ff; text-align:center;
  z-index: 0;                     /* плейсхолдер под ASCII */
  pointer-events: none;           /* чтобы не перехватывал события */
}
#placeholder .ph-ico{ font-size:48px; opacity:.7; }

/* Видео-источник должен быть «видим» для браузера, но вне экрана */
.capture-src{
  position: fixed;
  width: 1px;
  height: 1px;
  left: -99999px;
  top: -99999px;
  opacity: 0;
  pointer-events: none;
}

/* тулбары — без жестового зума/скролла */
.toolbar,
.modebar,
.panel { touch-action: manipulation; }

/* сцена берёт все жесты (пинч-зум) */
#stage {
  touch-action: none; }

/* Централизованная подсветка активного режима */
.modebar .btn { color:#808080; }
.modebar .btn.active { color:#ffffff; }

/* === Custom Color Picker (Android) === */
#cp-modal[hidden]{ display:none !important; }
#cp-modal{
  position:fixed; inset:0; z-index:99999;
  display:flex; align-items:center; justify-content:center;
  font-family:'BetterVCR', sans-serif; /* твой шрифт */
}
#cp-modal .cp-backdrop{
  position:absolute; inset:0; background:rgba(0,0,0,.65); backdrop-filter: blur(2px);
}
#cp-modal .cp-card{
  position:relative; width:92vw; max-width:420px;
  background:#2a2a2a; color:#fff; border-radius:12px; padding:16px;
  box-shadow:0 10px 40px rgba(0,0,0,.5);
}
#cp-modal .cp-title{ font-size:18px; margin-bottom:10px; }
#cp-modal .cp-row{ display:flex; gap:10px; align-items:center; }
#cp-modal canvas#cp-sv{
  width:220px; height:160px; border-radius:6px; background:#000; touch-action:none;
}
#cp-modal .cp-side{ display:flex; flex-direction:column; gap:10px; align-items:center; }
#cp-modal #cp-h{
  appearance:none; -webkit-appearance:none; writing-mode: bt-lr;
  width: 18px; height: 160px; background: linear-gradient(180deg, red, #ff0, #0f0, #0ff, #00f, #f0f, red);
  border-radius: 6px; outline:none; border:none;
}
#cp-modal #cp-h::-webkit-slider-thumb{ -webkit-appearance:none; width:18px; height:6px; background:#fff; }
#cp-modal #cp-h::-moz-range-thumb{ width:18px; height:6px; background:#fff; border:none; }
#cp-modal .cp-preview{ width:42px; height:42px; border:1px solid #444; border-radius:6px; display:flex; align-items:center; justify-content:center; }
#cp-modal #cp-preview-swatch{ display:block; width:32px; height:32px; border-radius:4px; background:#fff; }
#cp-modal .cp-actions{ margin-top:12px; display:flex; justify-content:flex-end; gap:16px; }
#cp-modal .cp-actions button{ color:#9bc0ff; background:transparent; border:0; padding:.4rem .6rem; }
