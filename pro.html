<!doctype html><html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>ASCII live · pro</title>
<link rel="stylesheet" href="styles.css?v=15">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="consent.js" defer></script>
</head>
<body class="theme-dark">
<div class="wrap">
  <div class="toolbar" id="toolbar">
    <button id="flip" class="btn">РАЗВЕРНУТЬ</button>
    <button id="fs"   class="btn ghost">FULLSCREEN</button>
    <a class="btn ghost" href="index.html">ПРИЛОЖЕНИЕ</a>
  </div>

  <div class="panel">
    <label>ШИРИНА <input id="w" type="range" min="40" max="320" value="160"><span id="wv">160</span></label>
    <label>КОНТРАСТ <input id="contrast" type="range" min="50" max="220" value="115"><span id="cv">1.15</span></label>
    <label>ГАММПА <input id="gamma" type="range" min="60" max="180" value="120"><span id="gv">1.20</span></label>
    <label>ТЕКСТ <input id="fg" type="color" value="#8ac7ff"></label>
    <label>ФОН <input id="bg" type="color" value="#000000"></label>
    <label>FPS <input id="fps" type="range" min="5" max="60" value="30"><span id="fpsv">30</span></label>
    <label>Набор
      <select id="preset">
        <option value="classic">CLASSIC</option>
        <option value="digits">NUMBERS</option>
        <option value="letters">LETTERS</option>
        <option value="dots">Точки</option>
        <option value="blocks">░▒▓█</option>
        <option value="custom">CUSTOM</option>
      </select>
      <input id="ramp" type="text" placeholder="свой набор символов" style="width:240px;display:none">
    </label>
    <label><input id="invert" type="checkbox" checked> ИНВЕРСИЯ</label>
  </div>

  <!-- фиксированная рамка вывода, забирает весь остаток окна -->
  <div class="stage"><pre id="out"></pre></div>
</div>

<div class="modal" id="consent" hidden>
  <div class="card">
    <h3>Доступ к камере</h3>
    <p>Видеопоток обрабатывается локально на вашем устройстве.</p>
    <button id="agree" class="btn" type="button">Ок, понимаю</button>
  </div>
</div>

<script type="module">
import { AsciiApp, wireFullscreen } from './ascii.js';
if (window.Telegram?.WebApp) { Telegram.WebApp.ready(); Telegram.WebApp.expand(); }

const $ = id => document.getElementById(id);
const ui = { out:$('out'), flip:$('flip'), fs:$('fs'), toolbar:$('toolbar') };
const app = new AsciiApp(ui.out);

function presetRamp(name){
  switch(name){
    case 'digits':  return ' 00112233445566778899';
    case 'letters': return '  iIl1tTjfJrRvxXcCuUnNzZmwWQO';
    case 'dots':    return " .'`^,:;-_~";
    case 'blocks':  return ' ░▒▓█';
    case 'classic':
    default:        return " .'`\",:;Il!i~+_-?][}{1tfjrxnuvczXYUJCLQ0089@#";
  }
}
function apply(){
  $('wv').textContent = $('w').value;
  $('cv').textContent = (+$('contrast').value/100).toFixed(2);
  $('gv').textContent = (+$('gamma').value/100).toFixed(2);
  $('fpsv').textContent = $('fps').value;

  let ramp = presetRamp($('preset').value);
  if ($('preset').value === 'custom'){
    $('ramp').style.display = 'inline-block';
    ramp = $('ramp').value || ramp;
  } else {
    $('ramp').style.display = 'none';
  }
  app.setOptions({
    widthChars:+$('w').value,
    contrast:+$('contrast').value/100,
    gamma:+$('gamma').value/100,
    color:$('fg').value,
    background:$('bg').value,
    fps:+$('fps').value,
    ramp,
    invert:$('invert').checked
  });
}
['w','contrast','gamma','fg','bg','fps','preset','ramp','invert'].forEach(id=>{
  $(id).addEventListener('input', apply);
  $(id).addEventListener('change', apply);
});
apply();

function startNow(){ app.start().catch(e=>alert('Камера недоступна: ' + e.message)); }
if (localStorage.getItem('consent-ok') === '1') startNow();
else document.addEventListener('consent-ready', startNow, { once:true });

ui.flip.onclick = () => app.flip();
wireFullscreen(ui.fs, ui.toolbar);
</script>
</body></html>


