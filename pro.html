<!doctype html><html><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>ASCII live · pro</title>
<link rel="stylesheet" href="styles.css">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head><body class="theme-dark">
<div class="wrap">
  <div class="toolbar">
    <button id="start" class="btn">Начать</button>
    <button id="stop"  class="btn" disabled>Стоп</button>
    <button id="flip"  class="btn">Фронт/Тыл</button>
    <a class="btn ghost" href="app.html">Fullscreen</a>
  </div>

  <div class="panel">
    <label>Ширина (симв.): <input id="w" type="range" min="40" max="240" value="140"><span id="wv">140</span></label>
    <label>Контраст: <input id="contrast" type="range" min="50" max="200" value="115"><span id="cv">1.15</span></label>
    <label>Гамма: <input id="gamma" type="range" min="60" max="180" value="120"><span id="gv">1.20</span></label>
    <label>Цвет символов: <input id="fg" type="color" value="#8ac7ff"></label>
    <label>Цвет фона: <input id="bg" type="color" value="#000000"></label>
    <label>FPS лимит: 
      <select id="fps">
        <option>30</option><option selected>20</option><option>15</option><option>10</option>
      </select>
    </label>
    <label>Набор символов:
      <input id="ramp" type="text" value=" .'`^&quot;,:;Il!i~+_-?][}{1tfjrxnuvczXYUJCLQ0089@#">
    </label>
    <label><input id="invert" type="checkbox"> Инвертировать яркость</label>
  </div>

  <div class="stage"><pre id="out"></pre></div>
</div>

<script type="module">
import { AsciiApp } from './ascii.js';
if (window.Telegram?.WebApp) { Telegram.WebApp.ready(); Telegram.WebApp.expand(); }

const $ = (id)=>document.getElementById(id);
const ui = { start:$('start'), stop:$('stop'), flip:$('flip'), out:$('out') };
const app = new AsciiApp(ui.out);

const w=$('w'), wv=$('wv'), contrast=$('contrast'), cv=$('cv'), gamma=$('gamma'), gv=$('gv'),
      fg=$('fg'), bg=$('bg'), fps=$('fps'), ramp=$('ramp'), invert=$('invert');

function apply() {
  wv.textContent = w.value;
  cv.textContent = (contrast.value/100).toFixed(2);
  gv.textContent = (gamma.value/100).toFixed(2);
  app.setOptions({
    widthChars: +w.value,
    contrast:   +contrast.value/100,
    gamma:      +gamma.value/100,
    color:      fg.value,
    background: bg.value,
    fps:        +fps.value,
    ramp:       ramp.value,
    invert:     invert.checked
  });
}
[w,contrast,gamma,fg,bg,fps,ramp,invert].forEach(el => el.addEventListener('input', apply));
apply();

ui.start.onclick = () => app.start().then(()=>{ ui.start.disabled = true; ui.stop.disabled = false; })
  .catch(e=>alert('Камера недоступна: '+e.message));
ui.stop.onclick  = () => { app.stop(); ui.start.disabled=false; ui.stop.disabled=true; };
ui.flip.onclick  = () => app.flip();
</script>
</body></html>
